#!/usr/bin/env bash

# Stolen from sylvan franklin

if ! tmux list-sessions &>/dev/null; then
    echo "Start tmux first"
    exit 1
fi

HOSTESS_CMD=$(which hostess)

CATEGORIES=(
    "SCHOOL"
    "CAREER"
    "CODING"
    "WASTE"
    "STOP"
)

selected=$(printf "%s\n" "${CATEGORIES[@]}" | fzf --bind 'q:abort')
fzf_status=$?

if [[ $fzf_status -ne 0 || -z "$selected" ]]; then
    exit 0
fi

if [[ "$selected" == "WASTE" ]]; then
    random_code=$(openssl rand -hex 16)
    echo "To unblock sites, copy this code:"
    echo "$random_code"
    echo ""
    read -p "Enter code: " user_input

    if [[ "$user_input" != "$random_code" ]]; then
        echo "Incorrect code. Aborting."
        exit 1
    fi
fi

tmux set -g status-interval 5

if [[ "$selected" == "STOP" ]]; then
    timew stop
else
    timew start "$selected"
        if [[ "$selected" == "WASTE" ]]; then
            sudo "$HOSTESS_CMD" rm www.youtube.com
            sudo "$HOSTESS_CMD" rm www.reddit.com
            sudo "$HOSTESS_CMD" rm www.linkedin.com
            sudo "$HOSTESS_CMD" rm news.ycombinator.com
        else
            sudo "$HOSTESS_CMD" add www.youtube.com      127.0.0.1
            sudo "$HOSTESS_CMD" add www.reddit.com       127.0.0.1
            sudo "$HOSTESS_CMD" add www.linkedin.com     127.0.0.1
            sudo "$HOSTESS_CMD" add news.ycombinator.com 127.0.0.1
        fi
fi
